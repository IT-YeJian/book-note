## 查询性能优化

如果查询写得很糟糕，即使库表结构再合理、索引再合适，也无法实现高性能

查询优化、索引优化、库表结构优化需要齐头并进，一个不落

## 为什么查询速度会慢

查询的生命周期大致可以按照顺序来看，从客户端到服务器，然后在服务器上进行解析，生成执行计划，执行，并返回结果给客户端

其中**执行** 可以认为是整个生命周期中最重要的阶段，这其中包括了大量为了检索数据到存储引擎的调用以及调用后的数据处理，包括排序，分组等。

在完成这些任务的时候，查询需要在不同的地方花费时间，包括网络，cpu计算，生成统计信息和执行计划，锁等待（互斥等待）等操作，尤其是向底层存储引擎
检索数据的调用操作，这些调用需要在内存操作，cpu操作和内存不足时导致的I/O操作上消耗时间。根据存储引擎的不同，可能还会产生大量的上下文切换以及系统调用

在每一个消耗大量时间的查询案例中，我们都能看到一些不必要的额外操作，某些操作被额外地重复了很多次，某些操作执行的太慢等。优化查询的目的就是减少和消除这些
操作所花费的时间。



